<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <title>サポートライブラリ DroidKaigi 2016</title>
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <style>
      @import url(http://fonts.googleapis.com/earlyaccess/notosansjapanese.css);

      body {
        font-family: 'Noto Sans Japanese', sans-serif;
      }

      a {
        text-decoration: none;
        color: blue;
      }

      a:visited {
        color: blue;
      }

      a:hover {
        text-decoration: underline;
      }

      li {
        line-height: 1.8;
      }

      h1, h2, h3 {
        font-family: 'Noto Sans Japanese', sans-serif;
        font-weight: bold;
      }

      /* ページ番号 */
      .remark-slide-number {
        color: #CCCCCC;
        font-size: 12pt;
        opacity: 1;
      }

      .hero {
        background-color: var(--bg-color);
        color: #fff;
      }

      .hero h1, .hero h2, .hero h3 {
        color: #FFFFFF;
      }

      .hero h2 {
        margin-left: 1em;
      }

      .normal {
        background-image: linear-gradient(180deg, var(--bg-color) 50%, #FFFFFF 50%);
        background-position: right 0em bottom 8em;
      }

      .normal h1 {
        color: white;
        margin-top: 0px;
        margin-left: 1em;
        font-size: 28pt;
      }

      .normal h2 {
        margin: 0px;
        font-size: 20pt;
      }

      .normal {
        font-size: 18pt;
      }

      .faq {
        background-color: var(--bg-color);
        font-size: 20pt;
        color: #fff;
      }

      .faq h1 {
        font-size: 28pt;
      }

      .remark-code, .remark-inline-code {
        font-family: monospace;
      }

      code {
        border-radius: 4px;
        max-height: 400px;
      }

      .hljs-googlecode .hljs {
        background-color: #EEEEEE;
        overflow-y: auto;
        overflow-x: hidden;
      }

      .card {
        background-color: white;
        border-radius: 0.1em;
        padding: 1em 2em;
        box-shadow: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);
      }

      .card img {
        float: right;
        margin-left: 1em;
        max-width: 32%;
        max-height: 32%;
      }

      .card .large img {
        float: none;
        max-width: 100%;
        max-height: 100%;
      }


      .chapter-1 {
        --bg-color: #F44336;
      }

      .chapter-2 {
        --bg-color: #3F51B5;
      }

      .chapter-3 {
        --bg-color: #009688;
      }

      .chapter-4 {
        --bg-color: #E91E63;
      }

      .chapter-5 {
        --bg-color: #FF5722;
      }

      .chapter-6 {
        --bg-color: #2196F3;
      }

    </style>
  </head>
  <body>
    <textarea id="source">
class: center, middle, hero, chapter-1

# <nobr>サポート ライブラリ<br>Droid Kaigi 2016</nobr>

---

class: normal, chapter-1

# 自己紹介

.card[
<!-- ![近影](../images/yaraki.png) -->

荒木佑一

[@yuichi_araki](https://twitter.com/yuichi_araki)

Developer Programs Engineer

- サポート ライブラリ (主に design ライブラリ)
- Google I/O アプリ
- Google Santa Tracker アプリ
- [d.android.com/samples](http://d.android.com/samples) のサンプルいろいろ
]

---

class: center, middle, hero, chapter-2

# <nobr>サポート ライブラリ<br>の<br>ススメ</nobr>

???

- 分かっている人にはおさらい

---

class: normal, chapter-2

# ご意見・ご要望

.card[
## b.android.com

- Template は "Support Library bug" を選択
- スクリーンショット重要
]

???

- サポート ライブラリ チームは割と頑張っています
- バグ報告でなくても、新機能要望でも "Support Library bug" でいい
- スクリーンショット、できれば動画
  - Android Studio で簡単に撮影できる

---

class: normal, chapter-2

# 背景

.card[
プラットフォームの新バージョンがリリースされる

- 新しい機能
- バグフィックス

古い API レベルも存在し続ける

どうやって互換性を保つか
]

???

- 最近で言えば
  - Lollipop でマテリアル デザイン
  - Marshmallow で新しい権限モデル
- これ自体はいいこと
- いわゆるフラグメンテーション

---

class: normal, chapter-2

# サポート ライブラリとは

.card[
Android アプリに組み込むライブラリ

Android プラットフォーム本体と並行して開発される

- プラットフォーム本体の機能のバックポート
- プラットフォーム本体には存在しない追加の機能
]

???

- Web の世界では "shim" や "polyfill" と呼ばれるもの
- 当初は API レベル間の互換性のためのライブラリだったが、今はいろいろ

---

class: normal, chapter-2

# サポート ライブラリ 一覧

.card[
- インフラ互換性: support-v4, support-v13, support-annotations
- UI 互換性: appcompat-v7, preferences-v7, preferences-v14
- UI ライブラリ: recyclerview-v7, design, percent, cardview-v7, gridlayout-v7
- その他: palette-v7, customtabs, renderscript-v8, mediarouter-v7, leanback-v17, recommendation, preference-leanback-v17
- 特殊: Testing Support Library (Espresso 含む), Data Binding, MultiDex
]

???

- 20 個ぐらい
- 「特殊」は他のサポート ライブラリとバージョンが別

---

class: normal, chapter-2

# 依存関係

.card[
  .large[![依存関係](dependencies.png)]
]

???

- 一部省略
- support-v4 がすべての基礎
- cardview-v7 が仲間外れ

---

class: normal, chapter-2

# support-v4

.card[
## プラットフォーム基本機能のバックポート

- 置き換え<br>
  Fragment, Loader など<br>
- なんとか Compat 系<br>
  ViewCompat, NotificationCompat など

## 一部追加機能

ViewPager, DrawerLayout, ViewDragHelper, FileProvider など
]

???

- 一番最初のサポートライブラリ "The support library"
- Gradle や AAR がなかった時代に作られたのでリソースを含まない
  - 互換性以外の機能も入っていてちょっとややこしい
- 「置き換え」はほぼフレームワークの機能そのまま
- 「なんとか Compat」は static メソッドがたくさん
- ゲームを除くほぼすべてのアプリが使うのでは
  - Lollipop や Marshmallow で一部の Deprecated メソッドが SDK から削除された
  - Jellybean で新しい API が導入されて古い機能は Deprecated になった
  - Marshmallow で削除された
  - ICS もサポートしたい場合、support-v4 を使う以外にない (自前で if 文分岐しようとしてもビルドできない)
  - なので必須ライブラリ

---

class: faq, chapter-2

# Q: どっちの Fragment を使えばいいの

- android.app.Fragment
- android.support.v4.app.Fragment
]

# A: android.support.v4.app.Fragment

???

- 一つ目はプラットフォームの Fragment、二つ目は support-v4 の Fragment
- minSdkVersion が 11 以降のアプリなら android.app.Fragment でも良さそうに思うが、他のサポートライブラリが support-v4 の Fragment を前提としていることがある
- 特に理由がなければ support-v4 の Fragment を使おう
]

---

class: normal, chapter-2

# appcompat-v7

.card[
![Google I/O 2015](iosched-main.webp)

KitKat 以前のプラットフォームでもマテリアル デザインを実現

バックポート専門: プラットフォームにない機能は入れない

<br><br><br>
]

???

- 以前は Holo のバックポートだった (ActionBarCompat)
  - 最小 SDK バージョンが ICS 以降なら必要ないのでは？ という意見もあった
- 現在はマテリアル デザインのバックポート
  - 特に理由がなければ使うはず

---

class: normal, chapter-2

# gridlayout-v7

.card[
API レベル 14 で追加された GridLayout のバックポート

格子状に View を配置するレイアウト
]

???

- 最小 SDK バージョンが Gingerbread とかのアプリで格子状に配置したい人に
- GridLayout に限ったことではないが、既存レイアウトを使うと難しい特殊なレイアウトを実現したい場合、ViewGroup を自作するのも手

---

class: normal, chapter-2

# recyclerview-v7

.card[
ListView や GridView を置き換える

Nested Scroll にも対応
]

???

- Q: ListView から移行すべき？
  - いま動いているなら別にいいのでは
  - 新規に作るなら RecyclerView の方が何かと便利 (モダンな API、Nested Scroll など)

---

class: normal, chapter-2

# cardview-v7

.card[
<br><br><br><br>
]

<br>

.card[
<br><br><br><br>
]

???

- マテリアル デザインっぽく見せるためだけに使い過ぎない
  - ガイドライン的には、一貫性のあるコンテンツはリストやタイル グリッドにすべき

---

class: normal, chapter-2

# percent

.card[
パーセント指定で View をレイアウトできる

PercentFrameLayout, PercentRelativeLayout

- layout_width/heightPercent
- layout_MarginStart/End/Top/BottomPercent
- layout_aspectRatio
]

???

- 主に Wear 用
  - 単に割合を指定したいなら LinearLayout の layout_weight で可能
- aspectRatio は幅÷高さ。width か height どっちかを指定してもう一方を計算させることができる

---

class: normal, chapter-2

# preference-v7/v14

.card[
PreferenceFragmentCompat

API レベル 11 で導入された PreferenceFragment のバックポート
]

???

- v7 は support-v4 の Fragment を継承、v14 はシステムの Fragment を継承
  - v14 を使うことはあまりないはず

---

class: normal, chapter-2

# palette-v7

.card[
画像から UI コンポーネントの配色に使える色を抽出する

[github.com/romainguy/google-io-2014](https://github.com/romainguy/google-io-2014)

]

???

- 最新版でパフォーマンスが 6 倍良くなった

---

class: normal, chapter-2

# customtabs

.card[
「アプリ内ブラウザ」

]

???

- WebView で自前で作るのに比べて
  - ログイン状態が引き継がれる
- Intent で Chrome などのブラウザに飛ばすのに比べて
  - メニュー項目のカスタマイズなどが可能

---

class: normal, chapter-2

# その他

.card[
## mediarouter-v7

Cast 対応

## leanback-v17, preference-leanback-v17, recommendation

Android TV 対応

## renderscript-v8

RenderScript (API レベル 11 以降) のバックポート
]

---

class: center, middle, hero, chapter-3

# Design Support Library

???

---

class: normal, chapter-3

# Design Support Library

.card[
![cheesesquare](design-cheesesquare.png)

マテリアル デザインで使われるコンポーネント群

API レベル 7 からサポート

appcompat-v7 の使用が前提

[github.com/chrisbanes/cheesesquare](https://github.com/chrisbanes/cheesesquare)
]

---

class: normal, chapter-3

# NavigationView

.card[
![NavigationView](design-navigationview.png)

ナビゲーション ドロワーの中のメニューをリソースで作ることができる

```xml
&lt;android.support.design.widget.NavigationView
  android:id="@+id/nav_view"
  android:layout_height="match_parent"
  android:layout_width="wrap_content"
  android:layout_gravity="start"
  android:fitsSystemWindows="true"
  app:headerLayout="@layout/nav_header"
  `app:menu="@menu/drawer_view"`/&gt;
```

<br>
]

???

- セクション分け、セクションのサブタイトルなどに対応
- app:actionLayout 属性でカスタム要素を追加できる
  - 例: Gmail の未読数、Google Play Music の「ダウンロード済み」のスイッチなど

---

class: normal, chapter-3

# TabLayout

.card[
![TabLayout](design-tablayout.png)

ViewPager (support-v4) と連携するタブ

```java
tabLayout.`setupWithViewPager(viewPager)`;
```

]

???

- 昔は ActionBar のナビゲーションモードでタブを作っていた
  - API レベル 21 で deprecated になった

---

class: normal, chapter-3

# TextInputLayout

.card[
![TextInputLayout](design-textinputlayout.png)

EditText に機能追加<br>
ヒント、エラー、カウンター

```xml
&lt;android.support.design.widget.TextInputLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        app:counterEnabled="true"
        app:counterMaxLength="30"&gt;
  &lt;EditText
      android:layout_width="match_parent"
      android:layout_height="wrap_content"
      android:hint="@string/description"/&gt;
&lt;/android.support.design.widget.TextInputLayout&gt;
```
]

---

class: normal, chapter-3

# FloatingActionButton

.card[
![FloatingActionButton](design-floatingactionbutton.png)

FAB

影付きの丸い ImageButton

```xml
&lt;android.support.design.widget.FloatingActionButton
        android:id="@+id/fab"
        android:layout_width="wrap_content"
        android:layout_height="wrap_content"
        android:fabSize="normal"
        android:src="@drawable/ic_done" /&gt;
```
]

???

- API レベルの違いによる影の扱いは CardView と同じ

---

class: normal, chapter-3

# Snackbar

.card[
![Snackbar](design-snackbar.png)

Toast の進化版

アクションを設定できる

```java
Snackbar.make(view, "Here's a Snackbar",
              Snackbar.LENGTH_LONG)
        .setAction("Action", new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                // ...
            }
        }).show();
```
]

???

- 使い方は大体 Toast と同じ
- show を忘れると出ないので注意
- 一つ目の引数は Context でなく View
  - 親を辿っていって CoordinatorLayout があればそこに Snackbar の View を出す
  - なければ適当に出す
- setAction でアクションを設定できる

---

class: normal, chapter-3

# CoordinatorLayout

.card[
超すごい FrameLayout

- 子要素の Behavior を取り持つ
- ある要素を別の要素に anchor する
- keyline に並べる
]

---

class: normal, chapter-3

# AppBarLayout

.card[
![AppBarLayout](design-appbarlayout.png)

スクロールに従って Toolbar を隠す

```xml
&lt;CoordinatorLayout&gt;
  &lt;AppBarLayout&gt;
    &lt;Toolbar
      app:layout_scrollFlags
      ="scroll|enterAlways|snap"/&gt;
    &lt;TabLayout/&gt;
  &lt;/AppBarLayout&gt;
&lt;/CoordinatorLayout&gt;
```
]

---

class: normal, chapter-3

# CollapsingToolbarLayout

.card[
![CollapsingToolbarLayout](design-collapsingtoolbarlayout.png)

Toolbar に動きを加える

```xml
&lt;CoordinatorLayout&gt;
  &lt;AppBarLayout&gt;
    &lt;CollapsingToolbarLayout
      app:layout_scrollFlags
      ="scroll|exitUntilCollapsed"&gt;
      &lt;ImageView
        app:layout_collapseMode="parallax"/&gt;
      &lt;Toolbar
        app:layout_collapseMode="pin"/&gt;
    &lt;/CollapsingToolbarLayout&gt;
  &lt;/AppBarLayout&gt;
&lt;/CoordinatorLayout&gt;
```
]

???

- cheesesquare のようにタイトル文字を動かしたい場合、CollapsingToolbarLayout に setTitle しないといけないので注意

---

class: center, middle, hero, chapter-3

# Design ライブラリの新機能



    </textarea>
    <script src="https://gnab.github.io/remark/downloads/remark-latest.min.js">
    </script>
    <script>
      var hljs = remark.highlighter.engine;
    </script>
    <script src="http://gnab.github.io/remark/remark.language.js"></script>
    <script>
      var slideshow = remark.create({
        highlightStyle: 'googlecode',
        highlightLanguage: 'remark',
        highlightLines: true,
        highlightSpans: true,
        navigation: {
          click: false,
          scroll: false,
          touch: true
        }
      });
    </script>

<!-- 
FAQ 候補

* 後ろについている v7 とかは何
* サポート ライブラリをバージョンアップしたら動かなくなった
* CardView/FAB のマージンが API レベルによって違う
* 64k を超えたアプリの開発
  デバッグ版は multidex, リリース版は proguard
* ListView から RecyclerView に移行すべき?
* AppCompat なんとかっていう View を使うべき？
* android: と app: はどちらを使うべき
-->

  </body>
</html>
